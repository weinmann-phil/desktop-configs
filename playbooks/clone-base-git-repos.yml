- name: Whoami
  ansible.builtin.command: whoami
  become: yes
  become_user: mnv1c
  register: local_user

- name: Checkout NeoVim Base IDE
  ansible.builtin.git:
    repo: 'https://github.com/weinmann-phil/base-setup.nvim.git'
    dest: "/home/{{ local_user.stdout }}/.config/nvim"
    version: main

- name: Install Alire for Language Server Support
  ansible.builtin.git:
    repo: 'https://github.com/alire-project/alire.git'
    dest: "/home/{{ local_user.stdout }}/.config/alire"
    version: master
    # track_submodules: true
    force: yes

- name: Ensure bin folder exists within Alire Config
  ansible.builtin.stat:
    path: "/home/{{ local_user.stdout }}/.config/alire/bin"
  register: bin_folder

- name: Create bin Directory for Alire
  ansible.builtin.file:
    path: "/home/{{ local_user.stdout }}/.config/alire/bin"
    state: directory
    mode: 0755
  when: not bin_folder.stat.exists

- name: Build Alire CLI
  ansible.builtin.script: "/home/{{ local_user.stdout }}/.config/alire/dev/build.sh"
  args:
    chdir: "/home/{{ local_user.stdout }}/.config/alire"
    executable: /bin/bash

- name: CHeck if Alire Binaries Exist
  ansible.builtin.stat:
    path: "/home/{{ local_user.stdout }}/.config/alire/bin/alr"
  register: source_file_stat

- name: Move binaries to /usr/bin/
  ansible.builtin.copy:
    src: "/home/{{ local_user.stdout }}/.config/alire/bin/alr"
    dest: "/usr/bin"
  when: source_file_stat.exists

- name: Remove Binary Source File
  ansible.builtin.file:
    path: "/home/{{ local_user.stdout }}/.config/alire/bin/alr"
    state: absent
  when: source_file_stat.exists

    
